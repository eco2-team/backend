---
apiVersion: external-secrets.io/v1beta1
kind: ExternalSecret
metadata:
  name: ingress-acm-certificate
  namespace: default
spec:
  refreshInterval: 1h
  secretStoreRef:
    kind: ClusterSecretStore
    name: aws-ssm-store
  data:
  - secretKey: certificateArn
    remoteRef:
      key: /sesacthon/dev/ingress/acm-certificate-arn
  target:
    name: ingress-acm-arn
    creationPolicy: Owner
    template:
      type: Opaque
      metadata:
        annotations:
          # 이 Secret을 Ingress annotation에서 참조하기 위한 메타데이터
          description: ACM Certificate ARN for dev environment ingress
      data:
        certificate-arn: '{{ .certificateArn }}'
---
apiVersion: external-secrets.io/v1beta1
kind: ExternalSecret
metadata:
  name: auth-ingress-acm-certificate
  namespace: auth
spec:
  refreshInterval: 1h
  secretStoreRef:
    kind: ClusterSecretStore
    name: aws-ssm-store
  data:
  - secretKey: certificateArn
    remoteRef:
      key: /sesacthon/dev/ingress/acm-certificate-arn
  target:
    name: ingress-acm-arn
    creationPolicy: Owner
    template:
      type: Opaque
      data:
        certificate-arn: '{{ .certificateArn }}'
---
apiVersion: external-secrets.io/v1beta1
kind: ExternalSecret
metadata:
  name: argocd-ingress-acm-certificate
  namespace: argocd
spec:
  refreshInterval: 1h
  secretStoreRef:
    kind: ClusterSecretStore
    name: aws-ssm-store
  data:
  - secretKey: certificateArn
    remoteRef:
      key: /sesacthon/dev/ingress/acm-certificate-arn
  target:
    name: ingress-acm-arn
    creationPolicy: Owner
    template:
      type: Opaque
      data:
        certificate-arn: '{{ .certificateArn }}'
---
apiVersion: external-secrets.io/v1beta1
kind: ExternalSecret
metadata:
  name: grafana-ingress-acm-certificate
  namespace: grafana
spec:
  refreshInterval: 1h
  secretStoreRef:
    kind: ClusterSecretStore
    name: aws-ssm-store
  data:
  - secretKey: certificateArn
    remoteRef:
      key: /sesacthon/dev/ingress/acm-certificate-arn
  target:
    name: ingress-acm-arn
    creationPolicy: Owner
    template:
      type: Opaque
      data:
        certificate-arn: '{{ .certificateArn }}'
