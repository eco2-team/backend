apiVersion: v1
kind: ConfigMap
metadata:
  name: chat-worker-config
  labels:
    app: chat-worker
data:
  # Service
  CHAT_WORKER_SERVICE_NAME: chat-worker
  CHAT_WORKER_ENVIRONMENT: base
  CHAT_WORKER_LOG_LEVEL: INFO
  # CHAT_WORKER_RABBITMQ_URL: provided by ExternalSecret
  CHAT_WORKER_RABBITMQ_QUEUE: chat.process
  # Redis (기본 - cache, checkpoint, interaction state)
  # cache-redis: dev replicas=1 (항상 master), DB 2로 Celery(0,1)/Location(5)/Image(6) 격리
  CHAT_WORKER_REDIS_URL: redis://rfr-cache-redis.redis.svc.cluster.local:6379/2
  # Redis (Streams - 이벤트 발행, event-router가 소비)
  CHAT_WORKER_REDIS_STREAMS_URL: redis://rfr-streams-redis.redis.svc.cluster.local:6379/0
  # Checkpoint TTL (분, Worker Redis에 저장)
  CHAT_WORKER_CHECKPOINT_TTL_MINUTES: '1440'
  # Checkpoint Read-Through (Worker용, Cold Start PG Fallback)
  # Redis TTL 만료 세션 → PG에서 읽어 Redis로 promote (LRU)
  # CHAT_WORKER_CHECKPOINT_READ_POSTGRES_URL is in secrets (credentials)
  CHAT_WORKER_CHECKPOINT_READ_PG_POOL_MIN: '1'
  CHAT_WORKER_CHECKPOINT_READ_PG_POOL_MAX: '2'
  # Checkpoint Syncer (Redis → PostgreSQL 동기화)
  # CHAT_WORKER_SYNCER_POSTGRES_URL is in secrets (credentials)
  CHAT_WORKER_SYNCER_PG_POOL_MIN_SIZE: '1'
  CHAT_WORKER_SYNCER_PG_POOL_MAX_SIZE: '5'
  CHAT_WORKER_SYNCER_INTERVAL: '5.0'
  CHAT_WORKER_SYNCER_BATCH_SIZE: '50'
  # LLM Provider
  CHAT_WORKER_DEFAULT_PROVIDER: openai
  CHAT_WORKER_OPENAI_DEFAULT_MODEL: gpt-5.2
  # Image Generation (Responses API)
  CHAT_WORKER_ENABLE_IMAGE_GENERATION: 'false'
  CHAT_WORKER_IMAGE_GENERATION_MODEL: gpt-5.2
  CHAT_WORKER_IMAGE_GENERATION_DEFAULT_SIZE: 1024x1024
  CHAT_WORKER_IMAGE_GENERATION_DEFAULT_QUALITY: medium
  # Worker 설정
  CHAT_WORKER_CONCURRENCY: '40'
  CHAT_WORKER_TASK_TIMEOUT: '120'
  CHAT_WORKER_MAX_RETRIES: '2'
  # Shard 설정 (event_router와 동일)
  CHAT_SHARD_COUNT: '4'
  # gRPC Clients (Subagent)
  CHAT_WORKER_CHARACTER_GRPC_HOST: character-grpc.character.svc.cluster.local
  CHAT_WORKER_CHARACTER_GRPC_PORT: '50051'
  CHAT_WORKER_LOCATION_GRPC_HOST: location-grpc.location.svc.cluster.local
  CHAT_WORKER_LOCATION_GRPC_PORT: '50051'
  # gRPC Client (Image Storage)
  CHAT_WORKER_IMAGES_GRPC_HOST: images-api.images.svc.cluster.local
  CHAT_WORKER_IMAGES_GRPC_PORT: '50052'
  # External API Timeouts
  CHAT_WORKER_KAKAO_API_TIMEOUT: '10.0'
  CHAT_WORKER_KMA_API_TIMEOUT: '10.0'
  CHAT_WORKER_MOIS_WASTE_API_TIMEOUT: '15.0'
  CHAT_WORKER_KECO_API_TIMEOUT: '15.0'
