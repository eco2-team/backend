apiVersion: kustomize.config.k8s.io/v1beta1
kind: Kustomization

resources:
- ../base

# Prod-specific patches
patches:
  # EC2NodeClass - prod instance profile
- target:
    kind: EC2NodeClass
    name: default
  patch: |
    - op: replace
      path: /spec/instanceProfile
      value: prod-karpenter-node
    - op: replace
      path: /spec/tags/Environment
      value: prod

  # NodePool - prod limits (higher)
- target:
    kind: NodePool
    name: worker-scalable
  patch: |
    - op: replace
      path: /spec/limits/cpu
      value: 40
    - op: replace
      path: /spec/limits/memory
      value: 80Gi
    - op: replace
      path: /spec/disruption/consolidationPolicy
      value: WhenEmptyOrUnderutilized
