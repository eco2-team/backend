---
# RabbitMQ Queues 정의
# Classic Queue 사용 (Celery global QoS 호환)
---
# ━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━
# Celery Default Queue
# ━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━
# Celery task_default_queue 설정에서 참조하는 기본 큐
# chain/group 등 캔버스 기능 내부에서 사용됨
apiVersion: rabbitmq.com/v1beta1
kind: Queue
metadata:
  name: celery-default-queue
  namespace: rabbitmq
spec:
  name: celery
  type: classic
  durable: true
  autoDelete: false
  vhost: eco2
  # arguments 없음 (기본 큐, TTL/DLX 불필요)
  rabbitmqClusterReference:
    name: eco2-rabbitmq
    namespace: rabbitmq
---
# ━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━
# Scan Pipeline Queues (AI 파이프라인)
# ━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━
apiVersion: rabbitmq.com/v1beta1
kind: Queue
metadata:
  name: scan-vision-queue
  namespace: rabbitmq
spec:
  name: scan.vision
  type: classic  # Classic Queue (Celery 호환)
  durable: true
  autoDelete: false
  vhost: eco2
  arguments:
    # Dead Letter Exchange 연결
    x-dead-letter-exchange: dlx
    x-dead-letter-routing-key: dlq.scan.vision
    # 메시지 TTL: 1시간 (AI 타임아웃 대비)
    x-message-ttl: 3600000
  rabbitmqClusterReference:
    name: eco2-rabbitmq
    namespace: rabbitmq
---
apiVersion: rabbitmq.com/v1beta1
kind: Queue
metadata:
  name: scan-rule-queue
  namespace: rabbitmq
spec:
  name: scan.rule
  type: classic
  durable: true
  autoDelete: false
  vhost: eco2
  arguments:
    x-dead-letter-exchange: dlx
    x-dead-letter-routing-key: dlq.scan.rule
    x-message-ttl: 300000  # 5분 (Rule-based는 빠름)
  rabbitmqClusterReference:
    name: eco2-rabbitmq
    namespace: rabbitmq
---
apiVersion: rabbitmq.com/v1beta1
kind: Queue
metadata:
  name: scan-answer-queue
  namespace: rabbitmq
spec:
  name: scan.answer
  type: classic
  durable: true
  autoDelete: false
  vhost: eco2
  arguments:
    x-dead-letter-exchange: dlx
    x-dead-letter-routing-key: dlq.scan.answer
    x-message-ttl: 3600000  # 1시간 (GPT 호출)
  rabbitmqClusterReference:
    name: eco2-rabbitmq
    namespace: rabbitmq
---
# ━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━
# Scan Reward Queue (보상 판정 - scan-worker)
# ━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━
apiVersion: rabbitmq.com/v1beta1
kind: Queue
metadata:
  name: scan-reward-queue
  namespace: rabbitmq
spec:
  name: scan.reward
  type: classic
  durable: true
  autoDelete: false
  vhost: eco2
  arguments:
    x-dead-letter-exchange: dlx
    x-dead-letter-routing-key: dlq.scan.reward
    x-message-ttl: 3600000   # 1시간 (AI 처리 후)
  rabbitmqClusterReference:
    name: eco2-rabbitmq
    namespace: rabbitmq
---
# ━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━
# Character Match Queue (동기 응답, 빠른 처리)
# ━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━
apiVersion: rabbitmq.com/v1beta1
kind: Queue
metadata:
  name: character-match-queue
  namespace: rabbitmq
spec:
  name: character.match
  type: classic
  durable: true
  autoDelete: false
  vhost: eco2
  arguments:
    x-dead-letter-exchange: dlx
    x-dead-letter-routing-key: dlq.character.match
    x-message-ttl: 30000     # 30초 (빠른 응답 필요)
  rabbitmqClusterReference:
    name: eco2-rabbitmq
    namespace: rabbitmq
---
# ━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━
# Character Reward Queue (fire & forget, 백그라운드)
# ━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━
apiVersion: rabbitmq.com/v1beta1
kind: Queue
metadata:
  name: character-save-ownership-queue
  namespace: rabbitmq
spec:
  name: character.save_ownership
  type: classic
  durable: true
  autoDelete: false
  vhost: eco2
  arguments:
    x-dead-letter-exchange: dlx
    x-dead-letter-routing-key: dlq.character.save_ownership
    x-message-ttl: 86400000  # 24시간 (DB 저장 중요)
  rabbitmqClusterReference:
    name: eco2-rabbitmq
    namespace: rabbitmq
---
# ━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━
# Character Grant Default Queue (신규 사용자 기본 캐릭터 지급)
# ━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━
apiVersion: rabbitmq.com/v1beta1
kind: Queue
metadata:
  name: character-grant-default-queue
  namespace: rabbitmq
spec:
  name: character.grant_default
  type: classic
  durable: true
  autoDelete: false
  vhost: eco2
  arguments:
    x-dead-letter-exchange: dlx
    x-dead-letter-routing-key: dlq.character.grant_default
    x-message-ttl: 86400000  # 24시간
  rabbitmqClusterReference:
    name: eco2-rabbitmq
    namespace: rabbitmq
---
# ━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━
# Users Save Character Queue (users-worker)
# ━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━
apiVersion: rabbitmq.com/v1beta1
kind: Queue
metadata:
  name: users-save-character-queue
  namespace: rabbitmq
spec:
  name: users.save_character
  type: classic
  durable: true
  autoDelete: false
  vhost: eco2
  arguments:
    x-dead-letter-exchange: dlx
    x-dead-letter-routing-key: dlq.users.save_character
    x-message-ttl: 86400000  # 24시간
  rabbitmqClusterReference:
    name: eco2-rabbitmq
    namespace: rabbitmq
---
# ━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━
# Dead Letter Queues (실패 메시지 보관)
# ━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━
apiVersion: rabbitmq.com/v1beta1
kind: Queue
metadata:
  name: dlq-scan-vision
  namespace: rabbitmq
spec:
  name: dlq.scan.vision
  type: classic
  durable: true
  autoDelete: false
  vhost: eco2
  arguments:
    x-message-ttl: 604800000  # 7일 보관
  rabbitmqClusterReference:
    name: eco2-rabbitmq
    namespace: rabbitmq
---
apiVersion: rabbitmq.com/v1beta1
kind: Queue
metadata:
  name: dlq-scan-rule
  namespace: rabbitmq
spec:
  name: dlq.scan.rule
  type: classic
  durable: true
  autoDelete: false
  vhost: eco2
  arguments:
    x-message-ttl: 604800000
  rabbitmqClusterReference:
    name: eco2-rabbitmq
    namespace: rabbitmq
---
apiVersion: rabbitmq.com/v1beta1
kind: Queue
metadata:
  name: dlq-scan-answer
  namespace: rabbitmq
spec:
  name: dlq.scan.answer
  type: classic
  durable: true
  autoDelete: false
  vhost: eco2
  arguments:
    x-message-ttl: 604800000
  rabbitmqClusterReference:
    name: eco2-rabbitmq
    namespace: rabbitmq
---
apiVersion: rabbitmq.com/v1beta1
kind: Queue
metadata:
  name: dlq-scan-reward
  namespace: rabbitmq
spec:
  name: dlq.scan.reward
  type: classic
  durable: true
  autoDelete: false
  vhost: eco2
  arguments:
    x-message-ttl: 604800000  # 7일 보관
  rabbitmqClusterReference:
    name: eco2-rabbitmq
    namespace: rabbitmq
---
apiVersion: rabbitmq.com/v1beta1
kind: Queue
metadata:
  name: dlq-character-match
  namespace: rabbitmq
spec:
  name: dlq.character.match
  type: classic
  durable: true
  autoDelete: false
  vhost: eco2
  arguments:
    x-message-ttl: 604800000  # 7일 보관
  rabbitmqClusterReference:
    name: eco2-rabbitmq
    namespace: rabbitmq
---
apiVersion: rabbitmq.com/v1beta1
kind: Queue
metadata:
  name: dlq-character-save-ownership
  namespace: rabbitmq
spec:
  name: dlq.character.save_ownership
  type: classic
  durable: true
  autoDelete: false
  vhost: eco2
  arguments:
    x-message-ttl: 604800000  # 7일 보관
  rabbitmqClusterReference:
    name: eco2-rabbitmq
    namespace: rabbitmq
---
apiVersion: rabbitmq.com/v1beta1
kind: Queue
metadata:
  name: dlq-character-grant-default
  namespace: rabbitmq
spec:
  name: dlq.character.grant_default
  type: classic
  durable: true
  autoDelete: false
  vhost: eco2
  arguments:
    x-message-ttl: 604800000  # 7일 보관
  rabbitmqClusterReference:
    name: eco2-rabbitmq
    namespace: rabbitmq
---
apiVersion: rabbitmq.com/v1beta1
kind: Queue
metadata:
  name: dlq-users-save-character
  namespace: rabbitmq
spec:
  name: dlq.users.save_character
  type: classic
  durable: true
  autoDelete: false
  vhost: eco2
  arguments:
    x-message-ttl: 604800000  # 7일 보관
  rabbitmqClusterReference:
    name: eco2-rabbitmq
    namespace: rabbitmq
---
# ━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━
# Auth Blacklist Queue (auth-worker)
# ━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━
apiVersion: rabbitmq.com/v1beta1
kind: Queue
metadata:
  name: auth-blacklist-queue
  namespace: rabbitmq
spec:
  name: auth.blacklist
  type: classic
  durable: true
  autoDelete: false
  vhost: eco2
  arguments:
    x-dead-letter-exchange: dlx
    x-dead-letter-routing-key: dlq.auth.blacklist
    x-message-ttl: 86400000  # 24시간
  rabbitmqClusterReference:
    name: eco2-rabbitmq
    namespace: rabbitmq
---
apiVersion: rabbitmq.com/v1beta1
kind: Queue
metadata:
  name: dlq-auth-blacklist
  namespace: rabbitmq
spec:
  name: dlq.auth.blacklist
  type: classic
  durable: true
  autoDelete: false
  vhost: eco2
  arguments:
    x-message-ttl: 604800000  # 7일 보관
  rabbitmqClusterReference:
    name: eco2-rabbitmq
    namespace: rabbitmq
---
# ━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━
# Chat Process Queue (Taskiq - LangGraph 파이프라인)
# ━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━
apiVersion: rabbitmq.com/v1beta1
kind: Queue
metadata:
  name: chat-process-queue
  namespace: rabbitmq
spec:
  name: chat.process
  type: classic
  durable: true
  autoDelete: false
  vhost: eco2
  arguments:
    x-dead-letter-exchange: dlx
    x-dead-letter-routing-key: dlq.chat.process
    x-message-ttl: 3600000  # 1시간 (LLM 처리 시간 고려)
  rabbitmqClusterReference:
    name: eco2-rabbitmq
    namespace: rabbitmq
---
apiVersion: rabbitmq.com/v1beta1
kind: Queue
metadata:
  name: dlq-chat-process
  namespace: rabbitmq
spec:
  name: dlq.chat.process
  type: classic
  durable: true
  autoDelete: false
  vhost: eco2
  arguments:
    x-message-ttl: 604800000  # 7일 보관
  rabbitmqClusterReference:
    name: eco2-rabbitmq
    namespace: rabbitmq
---
# ━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━
# Info Worker Queue (뉴스 수집 - Celery Beat)
# ━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━
apiVersion: rabbitmq.com/v1beta1
kind: Queue
metadata:
  name: info-collect-news-queue
  namespace: rabbitmq
spec:
  name: info.collect_news
  type: classic
  durable: true
  autoDelete: false
  vhost: eco2
  arguments:
    x-dead-letter-exchange: dlx
    x-dead-letter-routing-key: dlq.info.collect_news
    x-message-ttl: 600000  # 10분 (Beat 주기 5분 고려)
  rabbitmqClusterReference:
    name: eco2-rabbitmq
    namespace: rabbitmq
---
apiVersion: rabbitmq.com/v1beta1
kind: Queue
metadata:
  name: dlq-info-collect-news
  namespace: rabbitmq
spec:
  name: dlq.info.collect_news
  type: classic
  durable: true
  autoDelete: false
  vhost: eco2
  arguments:
    x-message-ttl: 604800000  # 7일 보관
  rabbitmqClusterReference:
    name: eco2-rabbitmq
    namespace: rabbitmq
