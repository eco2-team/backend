---
# RabbitMQ Exchanges 정의
# Celery Task + Event Broadcasting용 Exchange
---
# 1. Scan Pipeline Exchange (Direct)
# 라우팅 키: scan.vision, scan.rule, scan.answer
apiVersion: rabbitmq.com/v1beta1
kind: Exchange
metadata:
  name: scan-direct
  namespace: rabbitmq
spec:
  name: scan.direct
  type: direct
  durable: true
  autoDelete: false
  vhost: eco2
  rabbitmqClusterReference:
    name: eco2-rabbitmq
    namespace: rabbitmq
---
# 2. Character Exchange (Direct)
# 라우팅 키: character.save_ownership (character DB 저장)
apiVersion: rabbitmq.com/v1beta1
kind: Exchange
metadata:
  name: character-direct
  namespace: rabbitmq
spec:
  name: character.direct
  type: direct
  durable: true
  autoDelete: false
  vhost: eco2
  rabbitmqClusterReference:
    name: eco2-rabbitmq
    namespace: rabbitmq
---
# 3. Reward Exchange (Direct)
# 1:N 라우팅: reward.character → character.save_ownership + users.save_character
# scan.reward 완료 시 1번 publish로 다중 Consumer에게 전달
apiVersion: rabbitmq.com/v1beta1
kind: Exchange
metadata:
  name: reward-direct
  namespace: rabbitmq
spec:
  name: reward.direct
  type: direct
  durable: true
  autoDelete: false
  vhost: eco2
  rabbitmqClusterReference:
    name: eco2-rabbitmq
    namespace: rabbitmq
---
# 4. Dead Letter Exchange (Direct)
# 실패한 메시지 수집용
apiVersion: rabbitmq.com/v1beta1
kind: Exchange
metadata:
  name: dlx
  namespace: rabbitmq
spec:
  name: dlx
  type: direct
  durable: true
  autoDelete: false
  vhost: eco2
  rabbitmqClusterReference:
    name: eco2-rabbitmq
    namespace: rabbitmq
---
# 5. Blacklist Events Exchange (Fanout)
# ext-authz 로컬 캐시 동기화용
# auth-api logout → 이벤트 발행 → ext-authz pods 캐시 업데이트
apiVersion: rabbitmq.com/v1beta1
kind: Exchange
metadata:
  name: blacklist-events
  namespace: rabbitmq
spec:
  name: blacklist.events
  type: fanout
  durable: true
  autoDelete: false
  vhost: eco2
  rabbitmqClusterReference:
    name: eco2-rabbitmq
    namespace: rabbitmq
---
# 6. Character Cache Exchange (Fanout)
# Worker 로컬 캐시 동기화용 - 모든 Worker가 수신
apiVersion: rabbitmq.com/v1beta1
kind: Exchange
metadata:
  name: character-cache
  namespace: rabbitmq
spec:
  name: character.cache
  type: fanout
  durable: true
  autoDelete: false
  vhost: eco2
  rabbitmqClusterReference:
    name: eco2-rabbitmq
    namespace: rabbitmq
---
# 7. Celery Default Exchange - 삭제됨
# Celery는 AMQP Default Exchange ("") 사용
# Named Exchange로 마이그레이션 완료 시 이 주석도 삭제
