---
# RabbitMQ Bindings 정의
# Exchange → Queue 연결
---
# ━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━
# Scan Pipeline Bindings
# ━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━
apiVersion: rabbitmq.com/v1beta1
kind: Binding
metadata:
  name: scan-vision-binding
  namespace: rabbitmq
spec:
  source: scan.direct
  destination: scan.vision
  destinationType: queue
  routingKey: scan.vision
  vhost: eco2
  rabbitmqClusterReference:
    name: eco2-rabbitmq
    namespace: rabbitmq
---
apiVersion: rabbitmq.com/v1beta1
kind: Binding
metadata:
  name: scan-rule-binding
  namespace: rabbitmq
spec:
  source: scan.direct
  destination: scan.rule
  destinationType: queue
  routingKey: scan.rule
  vhost: eco2
  rabbitmqClusterReference:
    name: eco2-rabbitmq
    namespace: rabbitmq
---
apiVersion: rabbitmq.com/v1beta1
kind: Binding
metadata:
  name: scan-answer-binding
  namespace: rabbitmq
spec:
  source: scan.direct
  destination: scan.answer
  destinationType: queue
  routingKey: scan.answer
  vhost: eco2
  rabbitmqClusterReference:
    name: eco2-rabbitmq
    namespace: rabbitmq
---
# ━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━
# Scan Reward Binding (scan.direct → scan.reward)
# ━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━
apiVersion: rabbitmq.com/v1beta1
kind: Binding
metadata:
  name: scan-reward-binding
  namespace: rabbitmq
spec:
  source: scan.direct
  destination: scan.reward
  destinationType: queue
  routingKey: scan.reward
  vhost: eco2
  rabbitmqClusterReference:
    name: eco2-rabbitmq
    namespace: rabbitmq
---
# ━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━
# Character Match Binding (동기 응답용)
# ━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━
apiVersion: rabbitmq.com/v1beta1
kind: Binding
metadata:
  name: character-match-binding
  namespace: rabbitmq
spec:
  source: character.direct
  destination: character.match
  destinationType: queue
  routingKey: character.match
  vhost: eco2
  rabbitmqClusterReference:
    name: eco2-rabbitmq
    namespace: rabbitmq
---
# ━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━
# Reward → Character Save Ownership Binding (1:N 라우팅 #1)
# reward.direct에서 reward.character 키로 발행 시 이 큐로 전달
# ━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━
apiVersion: rabbitmq.com/v1beta1
kind: Binding
metadata:
  name: reward-to-character-ownership
  namespace: rabbitmq
spec:
  source: reward.direct
  destination: character.save_ownership
  destinationType: queue
  routingKey: reward.character
  vhost: eco2
  rabbitmqClusterReference:
    name: eco2-rabbitmq
    namespace: rabbitmq
---
# ━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━
# Reward → Users Save Character Binding (1:N 라우팅 #2)
# 동일한 reward.character 키로 이 큐에도 전달
# ━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━
apiVersion: rabbitmq.com/v1beta1
kind: Binding
metadata:
  name: reward-to-users-save-character
  namespace: rabbitmq
spec:
  source: reward.direct
  destination: users.save_character
  destinationType: queue
  routingKey: reward.character
  vhost: eco2
  rabbitmqClusterReference:
    name: eco2-rabbitmq
    namespace: rabbitmq
---
# ━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━
# Character Grant Default Binding (신규 사용자 기본 캐릭터 지급)
# ━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━
apiVersion: rabbitmq.com/v1beta1
kind: Binding
metadata:
  name: character-grant-default-binding
  namespace: rabbitmq
spec:
  source: character.direct
  destination: character.grant_default
  destinationType: queue
  routingKey: character.grant_default
  vhost: eco2
  rabbitmqClusterReference:
    name: eco2-rabbitmq
    namespace: rabbitmq
---
# ━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━
# Auth Blacklist Binding (Fanout - ext-authz 캐시 동기화)
# ━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━
apiVersion: rabbitmq.com/v1beta1
kind: Binding
metadata:
  name: auth-blacklist-binding
  namespace: rabbitmq
spec:
  source: blacklist.events
  destination: auth.blacklist
  destinationType: queue
  routingKey: ''  # Fanout exchange는 routing key 무시
  vhost: eco2
  rabbitmqClusterReference:
    name: eco2-rabbitmq
    namespace: rabbitmq
---
# ━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━
# Dead Letter Bindings
# ━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━
apiVersion: rabbitmq.com/v1beta1
kind: Binding
metadata:
  name: dlq-scan-vision-binding
  namespace: rabbitmq
spec:
  source: dlx
  destination: dlq.scan.vision
  destinationType: queue
  routingKey: dlq.scan.vision
  vhost: eco2
  rabbitmqClusterReference:
    name: eco2-rabbitmq
    namespace: rabbitmq
---
apiVersion: rabbitmq.com/v1beta1
kind: Binding
metadata:
  name: dlq-scan-rule-binding
  namespace: rabbitmq
spec:
  source: dlx
  destination: dlq.scan.rule
  destinationType: queue
  routingKey: dlq.scan.rule
  vhost: eco2
  rabbitmqClusterReference:
    name: eco2-rabbitmq
    namespace: rabbitmq
---
apiVersion: rabbitmq.com/v1beta1
kind: Binding
metadata:
  name: dlq-scan-answer-binding
  namespace: rabbitmq
spec:
  source: dlx
  destination: dlq.scan.answer
  destinationType: queue
  routingKey: dlq.scan.answer
  vhost: eco2
  rabbitmqClusterReference:
    name: eco2-rabbitmq
    namespace: rabbitmq
---
apiVersion: rabbitmq.com/v1beta1
kind: Binding
metadata:
  name: dlq-scan-reward-binding
  namespace: rabbitmq
spec:
  source: dlx
  destination: dlq.scan.reward
  destinationType: queue
  routingKey: dlq.scan.reward
  vhost: eco2
  rabbitmqClusterReference:
    name: eco2-rabbitmq
    namespace: rabbitmq
---
apiVersion: rabbitmq.com/v1beta1
kind: Binding
metadata:
  name: dlq-character-match-binding
  namespace: rabbitmq
spec:
  source: dlx
  destination: dlq.character.match
  destinationType: queue
  routingKey: dlq.character.match
  vhost: eco2
  rabbitmqClusterReference:
    name: eco2-rabbitmq
    namespace: rabbitmq
---
apiVersion: rabbitmq.com/v1beta1
kind: Binding
metadata:
  name: dlq-character-save-ownership-binding
  namespace: rabbitmq
spec:
  source: dlx
  destination: dlq.character.save_ownership
  destinationType: queue
  routingKey: dlq.character.save_ownership
  vhost: eco2
  rabbitmqClusterReference:
    name: eco2-rabbitmq
    namespace: rabbitmq
---
apiVersion: rabbitmq.com/v1beta1
kind: Binding
metadata:
  name: dlq-character-grant-default-binding
  namespace: rabbitmq
spec:
  source: dlx
  destination: dlq.character.grant_default
  destinationType: queue
  routingKey: dlq.character.grant_default
  vhost: eco2
  rabbitmqClusterReference:
    name: eco2-rabbitmq
    namespace: rabbitmq
---
apiVersion: rabbitmq.com/v1beta1
kind: Binding
metadata:
  name: dlq-users-save-character-binding
  namespace: rabbitmq
spec:
  source: dlx
  destination: dlq.users.save_character
  destinationType: queue
  routingKey: dlq.users.save_character
  vhost: eco2
  rabbitmqClusterReference:
    name: eco2-rabbitmq
    namespace: rabbitmq
---
apiVersion: rabbitmq.com/v1beta1
kind: Binding
metadata:
  name: dlq-auth-blacklist-binding
  namespace: rabbitmq
spec:
  source: dlx
  destination: dlq.auth.blacklist
  destinationType: queue
  routingKey: dlq.auth.blacklist
  vhost: eco2
  rabbitmqClusterReference:
    name: eco2-rabbitmq
    namespace: rabbitmq
