---
# auth 도메인에서 character-api로의 HTTP 통신 허용
# OAuth 로그인 후 기본 캐릭터 부여에 필요
apiVersion: networking.k8s.io/v1
kind: NetworkPolicy
metadata:
  name: allow-auth-to-character
  namespace: character
spec:
  podSelector:
    matchLabels:
      app: character-api
  policyTypes:
  - Ingress
  ingress:
  - from:
    - namespaceSelector:
        matchLabels:
          kubernetes.io/metadata.name: auth
    ports:
    - protocol: TCP
      port: 8000
---
# auth에서 character namespace로의 egress 허용
apiVersion: networking.k8s.io/v1
kind: NetworkPolicy
metadata:
  name: allow-auth-egress-to-character
  namespace: auth
spec:
  podSelector: {}  # 모든 auth pods
  policyTypes:
  - Egress
  egress:
  - to:
    - namespaceSelector:
        matchLabels:
          kubernetes.io/metadata.name: character
    ports:
    - protocol: TCP
      port: 8000
