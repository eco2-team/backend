apiVersion: kustomize.config.k8s.io/v1beta1
kind: Kustomization

resources:
- ../base

# labels 사용: includeSelectors: false로 Service selector에 라벨 추가 방지
labels:
- pairs:
    env: prod
  includeSelectors: false

# Prod 환경: base 설정 그대로 사용 (3 replicas)
# 필요시 리소스 증가
patches:
  # Cache Redis: 메모리 증가
- target:
    kind: RedisFailover
    name: cache-redis
  patch: |-
    - op: replace
      path: /spec/redis/resources/limits/memory
      value: 1Gi
    - op: replace
      path: /spec/redis/resources/requests/memory
      value: 512Mi
    - op: replace
      path: /spec/redis/customConfig
      value:
        - "maxmemory 768mb"
        - "maxmemory-policy allkeys-lru"
        - "tcp-keepalive 300"
        - "timeout 0"
        - "appendonly no"
        - "save \"\""
