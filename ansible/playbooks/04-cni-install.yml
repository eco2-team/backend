# CNI 플러그인 설치 (Flannel)
---
- name: Flannel 설치 여부 확인
  command: kubectl get daemonset -n kube-flannel kube-flannel-ds
  register: flannel_check
  failed_when: false
  changed_when: false

- name: Flannel CNI 설치
  command: kubectl apply -f https://github.com/flannel-io/flannel/releases/latest/download/kube-flannel.yml
  when: flannel_check.rc != 0

- name: Flannel Pod가 Ready 될 때까지 대기
  command: kubectl wait --for=condition=ready pod -l app=flannel -n kube-flannel --timeout=300s
  when: flannel_check.rc != 0

- name: 노드 상태 확인
  command: kubectl get nodes
  register: nodes_status
  changed_when: false

- name: 노드 상태 출력
  debug:
    msg: "{{ nodes_status.stdout_lines }}"

