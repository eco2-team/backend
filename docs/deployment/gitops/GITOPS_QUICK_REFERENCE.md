# GitOps μ „μ²΄ κµ¬μ„± μ”μ•½

## λΉ λ¥Έ μ°Έμ΅° κ°€μ΄λ“

### π― ν•µμ‹¬ κ°λ…

**Atlantis β‰  Ansible β‰  ArgoCD**

κ° λ„κµ¬λ” **μ„λ΅ λ‹¤λ¥Έ Layer**λ¥Ό κ΄€λ¦¬ν•λ©°, **λ€μ²΄ κ΄€κ³„κ°€ μ•„λ‹ ν‘λ ¥ κ΄€κ³„**μ…λ‹λ‹¤.

---

## π“ Layerλ³„ λ„κµ¬ λ§¤ν•‘

```
β”β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”
β”‚                    Application Code (κ°λ°μ)                     β”‚
β”‚                    src/auth, src/scan, etc.                      β”‚
β””β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”
                              β†“
                      GitHub Actions
                    (λΉλ“, ν…μ¤νΈ, μ΄λ―Έμ§€ν™”)
                              β†“
β”β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”
β”‚               Kubernetes Applications (ArgoCD)                   β”‚
β”‚         Deployments, Services, ConfigMaps, Secrets              β”‚
β”‚             k8s/auth/, k8s/scan/, k8s/database/                 β”‚
β””β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”
                              β†“
                    kubectl apply (μλ™)
                              β†“
β”β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”
β”‚             Kubernetes Cluster (Ansible)                         β”‚
β”‚    Kubeadm, CNI, Labels, Cert-Manager, ALB Controller          β”‚
β”‚                 ansible/playbooks/*.yml                          β”‚
β””β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”
                              β†“
                  SSH & kubeadm commands
                              β†“
β”β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”
β”‚              AWS Infrastructure (Atlantis)                       β”‚
β”‚          EC2, VPC, IAM, Route53, CloudFront                     β”‚
β”‚                    terraform/*.tf                                β”‚
β””β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”
```

---

## π”§ λ„κµ¬λ³„ ν• μ¤„ μ”μ•½

| λ„κµ¬ | μ—­ν•  | κ΄€λ¦¬ λ€μƒ | μ‹¤ν–‰ λ°©μ‹ |
|------|------|-----------|-----------|
| **Atlantis** | AWS μΈν”„λΌ κ΄€λ¦¬ | EC2, VPC, IAM | PR μ½”λ©νΈ (`atlantis apply`) |
| **Ansible** | K8s ν΄λ¬μ¤ν„° μ„¤μ • | Kubeadm, CNI, μ»΄ν¬λ„νΈ | SSH + Playbook |
| **ArgoCD** | K8s μ•± λ°°ν¬ | Deployment, Service | Git Auto-Sync |
| **GitHub Actions** | CI/CD | λΉλ“, ν…μ¤νΈ, μ΄λ―Έμ§€ | Push μ΄λ²¤νΈ |

---

## π€ λ³€κ²½ μ‹λ‚λ¦¬μ¤λ³„ κ°€μ΄λ“

### Q: EC2 μΈμ¤ν„΄μ¤λ¥Ό μ¶”κ°€ν•λ ¤λ©΄?

**A: Atlantis (Terraform)**

```bash
1. terraform/variables.tf μμ •
2. Pull Request μƒμ„±
3. PR μ½”λ©νΈ: "atlantis apply"
```

---

### Q: Kubernetes CNIλ¥Ό μ—…κ·Έλ μ΄λ“ν•λ ¤λ©΄?

**A: Ansible**

```bash
1. ansible/playbooks/04-cni-install.yml μμ •
2. Git Push (ArgoCD Hook μλ™ μ‹¤ν–‰)
   λλ”
   ansible-playbook ansible/playbooks/04-cni-install.yml
```

---

### Q: Auth APIλ¥Ό μƒ λ²„μ „μΌλ΅ λ°°ν¬ν•λ ¤λ©΄?

**A: GitHub Actions β†’ ArgoCD**

```bash
1. src/auth/*.ts μμ •
2. Git Push
3. GitHub Actions μλ™ μ‹¤ν–‰ (λΉλ“ β†’ μ΄λ―Έμ§€ ν‘Έμ‹)
4. ArgoCD μλ™ λ°°ν¬
```

---

### Q: PostgreSQL λ©”λ¨λ¦¬λ¥Ό λλ¦¬λ ¤λ©΄?

**A: ArgoCD**

```bash
1. k8s/database/postgres-deployment.yaml μμ •
   (resources.requests.memory: "2Gi")
2. Git Push
3. ArgoCD μλ™ λ°°ν¬
```

---

## π“ Git μ €μ¥μ† κµ¬μ΅° (κ°„λ‹¨ λ²„μ „)

```
backend/
β”‚
β”β”€β”€ terraform/          # β† Atlantisκ°€ κ΄€λ¦¬
β”‚   β”β”€β”€ main.tf
β”‚   β”β”€β”€ vpc.tf
β”‚   β””β”€β”€ ec2.tf
β”‚
β”β”€β”€ ansible/            # β† Ansibleμ΄ κ΄€λ¦¬
β”‚   β””β”€β”€ playbooks/
β”‚       β”β”€β”€ site.yml
β”‚       β”β”€β”€ 01-prerequisites.yml
β”‚       β””β”€β”€ ...
β”‚
β”β”€β”€ k8s/                # β† ArgoCDκ°€ κ΄€λ¦¬
β”‚   β”β”€β”€ auth/
β”‚   β”β”€β”€ scan/
β”‚   β””β”€β”€ database/
β”‚
β”β”€β”€ src/                # β† GitHub Actionsκ°€ λΉλ“
β”‚   β”β”€β”€ auth/
β”‚   β””β”€β”€ scan/
β”‚
β””β”€β”€ .github/
    β””β”€β”€ workflows/      # β† CI/CD μ •μ
```

---

## π­ μ›ν¬ν”λ΅μ° μ‹κ°ν™”

### μ‹ κ· μΈν”„λΌ κµ¬μ¶• μ‹

```
Developer
    β†“ (μ½”λ“ μμ •)
β”β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”
β”‚ 1. Atlantis: terraform apply                              β”‚
β”‚    β†’ AWS μΈν”„λΌ μƒμ„± (EC2, VPC, IAM)                      β”‚
β””β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”
    β†“
β”β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”
β”‚ 2. Ansible: ansible-playbook site.yml                     β”‚
β”‚    β†’ Kubernetes ν΄λ¬μ¤ν„° μ΄κΈ°ν™”                            β”‚
β”‚    β†’ CNI, λ…Έλ“ λ μ΄λΈ”, μΈν”„λΌ μ»΄ν¬λ„νΈ μ„¤μΉ                β”‚
β””β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”
    β†“
β”β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”
β”‚ 3. ArgoCD: Auto-Sync                                       β”‚
β”‚    β†’ μ• ν”λ¦¬μΌ€μ΄μ… λ°°ν¬ (Auth, Scan, DB λ“±)                 β”‚
β””β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”
    β†“
β”β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”
β”‚ 4. GitHub Actions: Push μ΄λ²¤νΈ                             β”‚
β”‚    β†’ μ‹ κ· μ½”λ“ λΉλ“ & λ°°ν¬                                 β”‚
β””β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”
```

---

### μΌμƒ κ°λ° μ›ν¬ν”λ΅μ°

```
Developer: μ½”λ“ μμ • (src/auth/*.ts)
    β†“
    Git Push
    β†“
GitHub Actions νΈλ¦¬κ±°
    β”β”€ λΉλ“
    β”β”€ ν…μ¤νΈ
    β”β”€ Docker μ΄λ―Έμ§€ μƒμ„±
    β””β”€ μ΄λ―Έμ§€ ν‘Έμ‹ (v1.2.3)
    β†“
    k8s/auth/auth-deployment.yaml μ—…λ°μ΄νΈ
    (image: auth-api:v1.2.3)
    β†“
    Git Push
    β†“
ArgoCD κ°μ§€
    β†“
    μλ™ λ°°ν¬ (3λ¶„ μ΄λ‚΄)
    β†“
    β… μƒ λ²„μ „ λ°°ν¬ μ™„λ£
```

---

## β“ FAQ

### Q1: Atlantisλ¥Ό λ„μ…ν•λ©΄ Ansibleμ΄ ν•„μ” μ—†λ‚μ”?

**A: μ•„λ‹μ”!**

- **Atlantis**: AWS λ¦¬μ†μ¤ μƒμ„± (EC2λ” λ§λ“¤μ§€λ§, μ•μ— Kubernetesλ¥Ό μ„¤μΉν•μ§€ μ•μ)
- **Ansible**: μƒμ„±λ EC2μ— SSHλ΅ μ ‘μ†ν•μ—¬ Kubernetes ν΄λ¬μ¤ν„° κµ¬μ„±

λ‘ λ‹¤ ν•„μ”ν•©λ‹λ‹¤.

---

### Q2: ArgoCDκ°€ μλ”λ° μ™ Ansibleλ„ ν•„μ”ν•κ°€μ”?

**A: κ΄€λ¦¬ λ²”μ„κ°€ λ‹¤λ¦…λ‹λ‹¤!**

- **Ansible**: 
  - Kubernetes ν΄λ¬μ¤ν„° μμ²΄ μ„¤μ • (Kubeadm, CNI)
  - λ…Έλ“ λ λ²¨ μ„¤μ • (μ‹μ¤ν… ν¨ν‚¤μ§€, μ»¤λ„ νλΌλ―Έν„°)
  - μΈν”„λΌ μ»΄ν¬λ„νΈ (Cert-Manager, ALB Controller)

- **ArgoCD**:
  - Kubernetes μ„μ—μ„ μ‹¤ν–‰λλ” μ• ν”λ¦¬μΌ€μ΄μ… λ°°ν¬
  - Deployment, Service λ“± K8s λ¦¬μ†μ¤

**ArgoCDλ” Kubernetesκ°€ μ΄λ―Έ μ¤€λΉ„λ μƒνƒμ—μ„ μ‘λ™ν•©λ‹λ‹¤.**

---

### Q3: μλ™ λ°°ν¬λ” μ–΄λ–»κ² ν•λ‚μ”?

**κ° λ„κµ¬λ³„ μλ™ μ‹¤ν–‰ λ°©λ²•:**

```bash
# Atlantis (Terraform)
cd terraform/
terraform plan
terraform apply

# Ansible
ansible-playbook -i ansible/inventory/hosts.ini \
  ansible/playbooks/site.yml

# ArgoCD
argocd app sync auth-api

# Kubernetes μ§μ ‘ λ°°ν¬
kubectl apply -f k8s/auth/auth-deployment.yaml
```

---

### Q4: λ΅¤λ°±μ€ μ–΄λ–»κ² ν•λ‚μ”?

**κ° λ„κµ¬λ³„ λ΅¤λ°± λ°©λ²•:**

```bash
# Atlantis (Terraform)
git revert <commit-hash>
# PR μƒμ„± β†’ atlantis apply

# Ansible
# μ΄μ „ λ²„μ „μ PlaybookμΌλ΅ μ¬μ‹¤ν–‰
git checkout <previous-commit>
ansible-playbook ansible/playbooks/site.yml

# ArgoCD
argocd app rollback auth-api <revision>
# λλ” Git revert β†’ Auto-sync

# Kubernetes μ§μ ‘ λ΅¤λ°±
kubectl rollout undo deployment/auth-api
```

---

## π“ ν•™μµ μμ„ κ¶μ¥

1. **Terraform + Atlantis**: μΈν”„λΌ μλ™ν™” μ΄ν•΄
2. **Ansible**: ν΄λ¬μ¤ν„° μ„¤μ • μλ™ν™” μ΄ν•΄
3. **ArgoCD**: μ• ν”λ¦¬μΌ€μ΄μ… λ°°ν¬ μλ™ν™” μ΄ν•΄
4. **GitHub Actions**: CI/CD νμ΄ν”„λΌμΈ μ΄ν•΄
5. **ν†µν•© μ›ν¬ν”λ΅μ°**: μ „μ²΄ νλ¦„ μ΄ν•΄

---

## π“– μƒμ„Έ λ¬Έμ„

- [GITOPS_ARCHITECTURE.md](./GITOPS_ARCHITECTURE.md): μ „μ²΄ κµ¬μ„± μƒμ„Έ μ„¤λ…
- [PHASE3_QUICK_START.md](./PHASE3_QUICK_START.md): Phase 3 GitOps μ‹μ‘ κ°€μ΄λ“
- [ATLANTIS_CURRENT_STATUS.md](./ATLANTIS_CURRENT_STATUS.md): Atlantis ν„μ¬ μƒνƒ

---

**μ‘μ„±μΌ**: 2025-11-11  
**λ²„μ „**: v1.0.0

