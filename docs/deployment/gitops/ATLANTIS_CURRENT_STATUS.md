# Atlantis í˜„ì¬ ë™ì‘ ìƒíƒœ ë° ì›Œí¬í”Œë¡œìš°

## ğŸ“‹ í˜„ì¬ ì„¤ì • ìƒíƒœ

### âœ… ì™„ë£Œëœ ì„¤ì •

1. **Atlantis Pod ë°°í¬**
   - Namespace: `atlantis`
   - Node: `k8s-monitoring` (ì •í™•í•œ ë…¸ë“œ ì§€ì •)
   - SecurityContext: `fsGroup: 1000`, `runAsUser: 1000` (ê¶Œí•œ ë¬¸ì œ í•´ê²°)
   - í¬íŠ¸: `--port=4141` (ëª…ì‹œì  ì„¤ì •)

2. **Atlantis ì„¤ì • íŒŒì¼ (`atlantis.yaml`)**
   - í”„ë¡œì íŠ¸: `infrastructure` (terraform ë””ë ‰í† ë¦¬)
   - Workflow: `infrastructure-workflow`
   - ìë™ Plan: `autoplan: enabled` (terraform íŒŒì¼ ë³€ê²½ ì‹œ)
   - Apply ìš”êµ¬ì‚¬í•­: `approved` + `mergeable`

3. **Ingress ë° Route53**
   - URL: `https://atlantis.growbin.app`
   - Service: NodePort íƒ€ì…
   - Route53 ë ˆì½”ë“œ: ìë™ ìƒì„±

---

## ğŸ”„ í˜„ì¬ ì›Œí¬í”Œë¡œìš°

### ì‹œë‚˜ë¦¬ì˜¤ 1: Terraform ë³€ê²½ë§Œ ìˆëŠ” ê²½ìš°

```
1. ê°œë°œì: terraform/*.tf íŒŒì¼ ìˆ˜ì • í›„ PR ìƒì„±
   â†“
2. Atlantis: ìë™ìœ¼ë¡œ terraform plan ì‹¤í–‰
   - PR ì½”ë©˜íŠ¸ì— Plan ê²°ê³¼ í‘œì‹œ
   â†“
3. íŒ€ì›: PR ë¦¬ë·° ë° ìŠ¹ì¸
   â†“
4. ê°œë°œì: PRì— "atlantis apply" ì½”ë©˜íŠ¸
   â†“
5. Atlantis: terraform apply ì‹¤í–‰
   - EC2 ì¸ìŠ¤í„´ìŠ¤ ìƒì„±/ìˆ˜ì •
   - Terraform Outputs â†’ ConfigMap ì €ì¥ (argocd namespace)
   â†“
6. GitHub Actions: ìë™ìœ¼ë¡œ Ansible Bootstrap ì‹¤í–‰
   - Terraform Outputs ì‚¬ìš©
   - Ansible Playbook ì‹¤í–‰
   â†“
7. GitHub Actions: ArgoCD Sync ì‹¤í–‰
   - Kubernetes ë¦¬ì†ŒìŠ¤ ë°°í¬
```

**ê²°ê³¼**: âœ… **ìë™ìœ¼ë¡œ í´ëŸ¬ìŠ¤í„°ì— ë°˜ì˜ë¨**

---

### ì‹œë‚˜ë¦¬ì˜¤ 2: Ansible ë³€ê²½ë§Œ ìˆëŠ” ê²½ìš°

```
1. ê°œë°œì: ansible/** íŒŒì¼ ìˆ˜ì • í›„ PR ìƒì„±
   â†“
2. GitHub Actions: terraform-plan ì‹¤í–‰ (ë³€ê²½ ì—†ìœ¼ë©´ ìŠ¤í‚µ)
   â†“
3. PR Merge â†’ main/develop ë¸Œëœì¹˜
   â†“
4. GitHub Actions: terraform-apply ì‹¤í–‰ (ë³€ê²½ ì—†ìœ¼ë©´ ìŠ¤í‚µ)
   â†“
5. GitHub Actions: ansible-bootstrap ì‹¤í–‰
   - ìƒˆë¡œìš´ Ansible ì„¤ì • ì ìš©
   â†“
6. GitHub Actions: argocd-sync ì‹¤í–‰
   - Kubernetes ë¦¬ì†ŒìŠ¤ ì—…ë°ì´íŠ¸
```

**ê²°ê³¼**: âœ… **ìë™ìœ¼ë¡œ í´ëŸ¬ìŠ¤í„°ì— ë°˜ì˜ë¨**

---

### ì‹œë‚˜ë¦¬ì˜¤ 3: Terraform + Ansible ë™ì‹œ ë³€ê²½

```
1. ê°œë°œì: terraform/*.tf + ansible/** íŒŒì¼ ìˆ˜ì • í›„ PR ìƒì„±
   â†“
2. Atlantis: terraform plan ì‹¤í–‰ (terraform ë³€ê²½ ê°ì§€)
   â†“
3. íŒ€ì›: PR ë¦¬ë·° ë° ìŠ¹ì¸
   â†“
4. ê°œë°œì: "atlantis apply" ì½”ë©˜íŠ¸
   â†“
5. Atlantis: terraform apply ì‹¤í–‰
   - EC2 ì¸ìŠ¤í„´ìŠ¤ ìƒì„±/ìˆ˜ì •
   - Terraform Outputs â†’ ConfigMap ì €ì¥
   â†“
6. GitHub Actions: ansible-bootstrap ì‹¤í–‰
   - ìƒˆë¡œìš´ Ansible ì„¤ì • ì ìš©
   â†“
7. GitHub Actions: argocd-sync ì‹¤í–‰
   - Kubernetes ë¦¬ì†ŒìŠ¤ ë°°í¬
```

**ê²°ê³¼**: âœ… **ìë™ìœ¼ë¡œ í´ëŸ¬ìŠ¤í„°ì— ë°˜ì˜ë¨**

---

## âš ï¸ í˜„ì¬ ì œí•œì‚¬í•­

### 1. AtlantisëŠ” Terraformë§Œ ì²˜ë¦¬

**í˜„ì¬ ìƒíƒœ**:
- AtlantisëŠ” `terraform/` ë””ë ‰í† ë¦¬ë§Œ ê°ì‹œ
- `ansible/` ë””ë ‰í† ë¦¬ ë³€ê²½ì€ Atlantisê°€ ê°ì§€í•˜ì§€ ì•ŠìŒ
- Ansible ì‹¤í–‰ì€ GitHub Actionsê°€ ë‹´ë‹¹

**ì˜í–¥**:
- Terraform ë³€ê²½: Atlantisê°€ ìë™ Plan/Apply
- Ansible ë³€ê²½: GitHub Actionsê°€ PR Merge í›„ ì‹¤í–‰

### 2. ì™„ì „ ìë™í™”ëŠ” ì•„ì§ ì•ˆ ë¨

**í˜„ì¬ ìƒíƒœ**:
- Phase 1/2 ë‹¨ê³„: Atlantis + GitHub Actions ì¡°í•©
- Phase 3 ë‹¨ê³„: Atlantis + ArgoCD Hooks (ì•„ì§ ë¯¸êµ¬í˜„)

**Phase 3ë¡œ ê°€ë©´**:
- Atlantis: Terraform Apply í›„ ConfigMap ì €ì¥
- ArgoCD PreSync Hook: Ansible ìë™ ì‹¤í–‰
- ì™„ì „ ìë™í™” ë‹¬ì„±

---

## ğŸ¯ ì‹¤ì œ ë™ì‘ í™•ì¸ ë°©ë²•

### 1. Atlantis Pod ìƒíƒœ í™•ì¸

```bash
# Master ë…¸ë“œì—ì„œ
kubectl get pods -n atlantis
kubectl logs -n atlantis atlantis-0 --tail=50
```

### 2. GitHub Webhook í™•ì¸

```bash
# GitHub Repository â†’ Settings â†’ Webhooks
# Payload URL: https://atlantis.growbin.app/events
# Content type: application/json
# SSL verification: âœ… Enabled
```

### 3. í…ŒìŠ¤íŠ¸ PR ìƒì„±

```bash
# 1. Feature ë¸Œëœì¹˜ ìƒì„±
git checkout -b test/atlantis-workflow

# 2. Terraform íŒŒì¼ ìˆ˜ì •
echo "# Test" >> terraform/main.tf

# 3. PR ìƒì„±
git add terraform/main.tf
git commit -m "test: Test Atlantis workflow"
git push origin test/atlantis-workflow

# 4. GitHubì—ì„œ PR ìƒì„±
# 5. Atlantisê°€ ìë™ìœ¼ë¡œ Plan ì‹¤í–‰í•˜ëŠ”ì§€ í™•ì¸
```

---

## ğŸ“Š ì›Œí¬í”Œë¡œìš° ë‹¤ì´ì–´ê·¸ë¨

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ ê°œë°œì: terraform/*.tf ë˜ëŠ” ansible/** ìˆ˜ì •                  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                     â”‚
                     â†“
        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
        â”‚ PR ìƒì„± (GitHub)           â”‚
        â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                     â”‚
        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
        â”‚                            â”‚
        â†“                            â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”          â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Terraform ë³€ê²½â”‚          â”‚ Ansible ë³€ê²½  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜          â””â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜
        â”‚                          â”‚
        â†“                          â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”      â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Atlantis Plan    â”‚      â”‚ GitHub Actions   â”‚
â”‚ (ìë™ ì‹¤í–‰)       â”‚      â”‚ (PR Merge í›„)     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜      â””â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
        â”‚                          â”‚
        â†“                          â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”      â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ PR ì½”ë©˜íŠ¸ì— Plan  â”‚      â”‚ Ansible Bootstrapâ”‚
â”‚ ê²°ê³¼ í‘œì‹œ         â”‚      â”‚ ì‹¤í–‰             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜      â””â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
        â”‚                          â”‚
        â†“                          â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”      â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ "atlantis apply"  â”‚      â”‚ ArgoCD Sync      â”‚
â”‚ ì½”ë©˜íŠ¸ ì…ë ¥       â”‚      â”‚ ì‹¤í–‰             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜      â””â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
        â”‚                          â”‚
        â†“                          â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”      â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Atlantis Apply   â”‚      â”‚ Kubernetes ë¦¬ì†ŒìŠ¤ â”‚
â”‚ ì‹¤í–‰             â”‚      â”‚ ë°°í¬ ì™„ë£Œ         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜      â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
        â”‚
        â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ ConfigMap ì €ì¥   â”‚
â”‚ (Terraform Outputs)
â””â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
        â”‚
        â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ GitHub Actions   â”‚
â”‚ Ansible ì‹¤í–‰     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
        â”‚
        â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ ArgoCD Sync      â”‚
â”‚ ì‹¤í–‰             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
        â”‚
        â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ âœ… í´ëŸ¬ìŠ¤í„° ë°˜ì˜  â”‚
â”‚ ì™„ë£Œ             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## âœ… ê²°ë¡ 

### í˜„ì¬ ìƒíƒœ

1. **Terraform ë³€ê²½**: âœ… **ìë™ ë°˜ì˜**
   - PR ìƒì„± â†’ Atlantis Plan â†’ Apply â†’ ConfigMap ì €ì¥ â†’ GitHub Actions Ansible ì‹¤í–‰

2. **Ansible ë³€ê²½**: âœ… **ìë™ ë°˜ì˜**
   - PR Merge â†’ GitHub Actions Ansible ì‹¤í–‰ â†’ ArgoCD Sync

3. **Terraform + Ansible ë™ì‹œ ë³€ê²½**: âœ… **ìë™ ë°˜ì˜**
   - Terraform: Atlantisê°€ ì²˜ë¦¬
   - Ansible: GitHub Actionsê°€ ì²˜ë¦¬

### ê°œì„  í•„ìš” ì‚¬í•­

1. **Phase 3ë¡œ ì „í™˜** (ì„ íƒì‚¬í•­)
   - ArgoCD Hooksë¡œ Ansible ìë™ ì‹¤í–‰
   - GitHub Actions ì˜ì¡´ì„± ì œê±°

2. **Webhook ì„¤ì • í™•ì¸**
   - GitHub Repositoryì— Webhookì´ ë“±ë¡ë˜ì–´ ìˆëŠ”ì§€ í™•ì¸
   - `https://atlantis.growbin.app/events` ì—”ë“œí¬ì¸íŠ¸ í™•ì¸

---

**ì‘ì„±ì¼**: 2025-11-09  
**ë²„ì „**: v0.7.0

