# ì´ì½”ì—ì½”(EcoÂ²) Agent #9: Vision Processing

> Chat Workerì— Vision ê¸°ëŠ¥ ì¶”ê°€ â€” ì´ë¯¸ì§€ ê¸°ë°˜ íê¸°ë¬¼ ë¶„ë¥˜

| í•­ëª©      | ê°’          |
| ------- | ---------- |
| **ì‘ì„±ì¼** | 2026-01-14 |
| **ì»¤ë°‹**  | da24a5db   |

---

## 1. ê°œìš”

### 1.1 ì™œ Visionì´ í•„ìš”í•œê°€?

ê¸°ì¡´ Chat WorkerëŠ” í…ìŠ¤íŠ¸ ê¸°ë°˜ ì§ˆë¬¸ë§Œ ì²˜ë¦¬í–ˆìŠµë‹ˆë‹¤:

```
ì‚¬ìš©ì: "í˜íŠ¸ë³‘ ì–´ë–»ê²Œ ë²„ë ¤ìš”?"
â†’ Intent ë¶„ë¥˜ â†’ RAG ê²€ìƒ‰ â†’ ë‹µë³€ ìƒì„±
```

í•˜ì§€ë§Œ ì‹¤ì œ ì‚¬ìš©ìëŠ” **ì‚¬ì§„ì„ ì°ì–´ì„œ** ì§ˆë¬¸í•©ë‹ˆë‹¤:

```
ì‚¬ìš©ì: [ğŸ“· ì´ë¯¸ì§€] "ì´ê±° ì–´ë–»ê²Œ ë²„ë ¤ìš”?"
â†’ ??? â†’ ë‹µë³€ ìƒì„±
```

**ë¬¸ì œ**: ì´ë¯¸ì§€ë§Œìœ¼ë¡œëŠ” Intent ë¶„ë¥˜ì™€ RAG ê²€ìƒ‰ì´ ë¶ˆê°€ëŠ¥

**í•´ê²°**: Vision ëª¨ë¸ë¡œ ì´ë¯¸ì§€ë¥¼ ë¨¼ì € ë¶„ë¥˜ â†’ ë¶„ë¥˜ ê²°ê³¼ë¡œ RAG ê²€ìƒ‰

### 1.2 ëª©í‘œ

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                      Vision ì²˜ë¦¬ ëª©í‘œ                        â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  1. ì´ë¯¸ì§€ â†’ íê¸°ë¬¼ ë¶„ë¥˜ (major/middle/minor category)       â”‚
â”‚  2. ë¶„ë¥˜ ê²°ê³¼ â†’ stateì— ì €ì¥                                 â”‚
â”‚  3. RAG ë…¸ë“œê°€ ë¶„ë¥˜ ê²°ê³¼ í™œìš©                                â”‚
â”‚  4. ê¸°ì¡´ í…ìŠ¤íŠ¸ í”Œë¡œìš° í˜¸í™˜ ìœ ì§€                              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## 2. ì•„í‚¤í…ì²˜ ì„¤ê³„

### 2.1 íŒŒì´í”„ë¼ì¸ í”Œë¡œìš° ë³€ê²½

**Before (í…ìŠ¤íŠ¸ ì „ìš©)**:
```
START â†’ intent â†’ router â†’ [waste_rag/character/location/general] â†’ answer â†’ END
```

**After (Vision ì¶”ê°€)**:
```
START â†’ intent â†’ [vision?] â†’ router â†’ [waste_rag/character/location/general] â†’ answer â†’ END
```

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                      Vision ì¶”ê°€ í”Œë¡œìš°                             â”‚
â”‚                                                                    â”‚
â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”      â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”      â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”                â”‚
â”‚   â”‚  START  â”‚â”€â”€â”€â”€â”€â”€â”‚   intent    â”‚â”€â”€â”€â”€â”€â”€â”‚vision? â”‚                â”‚
â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜      â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜      â””â”€â”€â”€â”¬â”€â”€â”€â”€â”˜                â”‚
â”‚                                             â”‚                      â”‚
â”‚                         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚                         â”‚ image_url ìˆìŒ    â”‚ image_url ì—†ìŒ    â”‚  â”‚
â”‚                         â–¼                   â–¼                   â”‚  â”‚
â”‚                    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”              â”‚  â”‚
â”‚                    â”‚ vision  â”‚         â”‚ router  â”‚â—„â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚                    â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”˜         â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”˜                 â”‚
â”‚                         â”‚                   â”‚                      â”‚
â”‚                         â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                      â”‚
â”‚                                   â”‚                                â”‚
â”‚              â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”           â”‚
â”‚              â–¼          â–¼         â–¼         â–¼          â”‚           â”‚
â”‚         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚           â”‚
â”‚         â”‚  waste â”‚ â”‚  char  â”‚ â”‚  loc   â”‚ â”‚general â”‚    â”‚           â”‚
â”‚         â”‚  (RAG) â”‚ â”‚ (gRPC) â”‚ â”‚ (gRPC) â”‚ â”‚(pass)  â”‚    â”‚           â”‚
â”‚         â””â”€â”€â”€â”¬â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”¬â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”¬â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”¬â”€â”€â”€â”€â”˜    â”‚           â”‚
â”‚             â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜         â”‚           â”‚
â”‚                              â”‚                         â”‚           â”‚
â”‚                         â”Œâ”€â”€â”€â”€â–¼â”€â”€â”€â”€â”                    â”‚           â”‚
â”‚                         â”‚ answer  â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜           â”‚
â”‚                         â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”˜                                â”‚
â”‚                              â”‚                                     â”‚
â”‚                         â”Œâ”€â”€â”€â”€â–¼â”€â”€â”€â”€â”                                â”‚
â”‚                         â”‚   END   â”‚                                â”‚
â”‚                         â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                                â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

**ì¡°ê±´ë¶€ ë¼ìš°íŒ… ë¡œì§**:
- `image_url` ìˆê³  `classification_result` ì—†ìŒ â†’ Vision ë…¸ë“œ
- ê·¸ ì™¸ â†’ Routerë¡œ ì§í–‰

### 2.2 Clean Architecture ê³„ì¸µ ë¶„ë¦¬

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                     Vision ê³„ì¸µ êµ¬ì¡°                         â”‚
â”‚                                                             â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚              Application Layer (Port)                 â”‚  â”‚
â”‚  â”‚                                                       â”‚  â”‚
â”‚  â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”‚  â”‚
â”‚  â”‚   â”‚            VisionModelPort (ABC)            â”‚     â”‚  â”‚
â”‚  â”‚   â”‚                                             â”‚     â”‚  â”‚
â”‚  â”‚   â”‚   + analyze_image(image_url, user_input)    â”‚     â”‚  â”‚
â”‚  â”‚   â”‚     â†’ dict[classification, tags, conf]     â”‚     â”‚  â”‚
â”‚  â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚                              â”‚                              â”‚
â”‚                              â”‚ implements                   â”‚
â”‚                              â–¼                              â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚            Infrastructure Layer (Adapters)            â”‚  â”‚
â”‚  â”‚                                                       â”‚  â”‚
â”‚  â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”         â”‚  â”‚
â”‚  â”‚   â”‚ OpenAIVision    â”‚     â”‚ GeminiVision    â”‚         â”‚  â”‚
â”‚  â”‚   â”‚    Client       â”‚     â”‚    Client       â”‚         â”‚  â”‚
â”‚  â”‚   â”‚                 â”‚     â”‚                 â”‚         â”‚  â”‚
â”‚  â”‚   â”‚  - GPT-4o       â”‚     â”‚  - Gemini 2.0   â”‚         â”‚  â”‚
â”‚  â”‚   â”‚  - detail: low  â”‚     â”‚  - Flash        â”‚         â”‚  â”‚
â”‚  â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜         â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

**í•µì‹¬ ì›ì¹™**: Application LayerëŠ” êµ¬ì²´ì ì¸ LLM êµ¬í˜„ì„ ëª°ë¼ì•¼ í•¨

---

## 3. ì˜ì‚¬ê²°ì •

### 3.1 Vision ëª¨ë¸ ì„ íƒ: GPT-5.2-vision vs Gemini 3 Flash

| ë¹„êµ í•­ëª© | GPT-5.2-vision | Gemini 3 Flash Preview |
|----------|----------------|------------------------|
| **ë¹„ìš©** | ~$0.002/ì´ë¯¸ì§€ (low) | ~$0.0001/ì´ë¯¸ì§€ |
| **ì†ë„** | ~1-2ì´ˆ | ~0.5-1ì´ˆ |
| **ì •í™•ë„** | ë§¤ìš° ë†’ìŒ | ë§¤ìš° ë†’ìŒ |
| **êµ¬ì¡°í™” ì¶œë ¥** | Structured Outputs | response_schema |
| **í•œêµ­ì–´** | ìš°ìˆ˜ | ìš°ìˆ˜ |
| **íŠ¹í™”** | Vision ì „ìš© ëª¨ë¸ | ë©€í‹°ëª¨ë‹¬ í†µí•© |

> **ëª¨ë¸ êµ¬ì„±**:
> - OpenAI: LLM `gpt-5.2-turbo` / Vision `gpt-5.2-vision` (ì „ìš© ëª¨ë¸)
> - Google: LLM/Vision í†µí•© `gemini-3-flash-preview` (ë©€í‹°ëª¨ë‹¬)

**ê²°ì •**: ë‘˜ ë‹¤ ì§€ì› (Factory Patternìœ¼ë¡œ êµì²´ ê°€ëŠ¥)

```python
# dependencies.py
def create_vision_client(
    provider: Literal["openai", "gemini"] = "openai",
) -> VisionModelPort:
    settings = get_settings()
    if provider == "gemini":
        # GeminiëŠ” ë©€í‹°ëª¨ë‹¬ì´ë¯€ë¡œ LLMê³¼ ë™ì¼ ëª¨ë¸
        return GeminiVisionClient(model=settings.gemini_default_model)
    # OpenAIëŠ” Vision ì „ìš© ëª¨ë¸
    return OpenAIVisionClient(model="gpt-5.2-vision")
```

### 3.2 ì´ë¯¸ì§€ detail ë ˆë²¨: high vs low

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚            GPT-5.2-vision detail ë¹„êµ                       â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  detail: high                                              â”‚
â”‚  - ê³ í•´ìƒë„ íƒ€ì¼ ë¶„í•  ì²˜ë¦¬                                   â”‚
â”‚  - í† í°: ì´ë¯¸ì§€ í¬ê¸°ì— ë¹„ë¡€                                  â”‚
â”‚  - ë¹„ìš©: ë†’ìŒ                                               â”‚
â”‚  - ìš©ë„: ì„¸ë°€í•œ í…ìŠ¤íŠ¸ ì¸ì‹, ë³µì¡í•œ ì´ë¯¸ì§€                   â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  detail: low  âœ… ì„ íƒ                                       â”‚
â”‚  - ì €í•´ìƒë„ ë‹¨ì¼ ì´ë¯¸ì§€                                     â”‚
â”‚  - í† í°: ìµœì†Œí™”                                             â”‚
â”‚  - ë¹„ìš©: ëŒ€í­ ì ˆê°                                          â”‚
â”‚  - ìš©ë„: íê¸°ë¬¼ ëŒ€ë¶„ë¥˜ (ì¶©ë¶„)                               â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

**ê²°ì •**: `detail: low` â€” íê¸°ë¬¼ ë¶„ë¥˜ëŠ” ëŒ€ë¶„ë¥˜ ìˆ˜ì¤€ì´ë©´ ì¶©ë¶„

### 3.3 Vision ë…¸ë“œ ìœ„ì¹˜: Intent ì „ vs Intent í›„

| ì˜µì…˜ | Intent â†’ Vision | Intent â†’ Vision? |
|------|-----------------|------------------|
| **ì¥ì ** | ê°„ë‹¨í•œ í”Œë¡œìš° | ë¶ˆí•„ìš”í•œ Vision í˜¸ì¶œ ë°©ì§€ |
| **ë‹¨ì ** | í•­ìƒ Vision í˜¸ì¶œ | ì¡°ê±´ë¶€ ë¼ìš°íŒ… ë³µì¡ |
| **ë¹„ìš©** | ë†’ìŒ | ë‚®ìŒ |

**ê²°ì •**: Intent í›„ ì¡°ê±´ë¶€ Vision í˜¸ì¶œ

```python
def route_after_intent(state: dict) -> str:
    if state.get("image_url") and not state.get("classification_result"):
        return "vision"
    return "router"
```

---

## 4. êµ¬í˜„ ìƒì„¸

### 4.1 VisionModelPort (Application Layer)

```python
# application/ports/vision/vision_model.py
class VisionModelPort(ABC):
    """Vision ëª¨ë¸ Port - ì´ë¯¸ì§€ ë¶„ë¥˜ ì¶”ìƒ ì¸í„°í˜ì´ìŠ¤."""
    
    @abstractmethod
    async def analyze_image(
        self,
        image_url: str,
        user_input: str | None = None,
    ) -> dict[str, Any]:
        """ì´ë¯¸ì§€ ë¶„ì„ â†’ ë¶„ë¥˜ ê²°ê³¼ ë°˜í™˜.
        
        Returns:
            {
                "classification": {
                    "major_category": "ì¬í™œìš©íê¸°ë¬¼",
                    "middle_category": "í”Œë¼ìŠ¤í‹±ë¥˜",
                    "minor_category": "í˜íŠ¸ë³‘",
                },
                "situation_tags": ["ì„¸ì²™í•„ìš”", "ë¼ë²¨ì œê±°í•„ìš”"],
                "confidence": 0.95,
            }
        """
        pass
```

### 4.2 OpenAI Vision Client (Infrastructure Layer)

```python
# infrastructure/llm/vision/openai_vision.py
class OpenAIVisionClient(VisionModelPort):
    async def analyze_image(self, image_url: str, user_input: str | None = None):
        response = self._client.beta.chat.completions.parse(
            model=self._model,
            messages=[
                {"role": "system", "content": self._prompt},
                {
                    "role": "user",
                    "content": [
                        {"type": "text", "text": user_input or "ì´ íê¸°ë¬¼ì„ ë¶„ë¥˜í•´ì£¼ì„¸ìš”."},
                        {
                            "type": "image_url",
                            "image_url": {"url": image_url, "detail": "low"},
                        },
                    ],
                },
            ],
            response_format=VisionResult,  # Pydantic êµ¬ì¡°í™” ì¶œë ¥
        )
        return response.choices[0].message.parsed.model_dump()
```

### 4.3 Vision Node (Orchestration Layer)

```python
# infrastructure/orchestration/langgraph/nodes/vision_node.py
def create_vision_node(vision_model: VisionModelPort, event_publisher: ProgressNotifierPort):
    async def vision_node(state: dict) -> dict:
        job_id = state.get("job_id", "")
        image_url = state.get("image_url")
        
        # ì´ë¯¸ì§€ ì—†ìœ¼ë©´ ìŠ¤í‚µ
        if not image_url:
            return state
        
        # 1. ì§„í–‰ ì´ë²¤íŠ¸ ë°œí–‰
        await event_publisher.notify_stage(
            task_id=job_id,
            stage="vision",
            status="processing",
            progress=15,
            message="ğŸ” ì´ë¯¸ì§€ ë¶„ì„ ì¤‘...",
        )
        
        # 2. Vision ëª¨ë¸ í˜¸ì¶œ
        result = await vision_model.analyze_image(image_url, state.get("message"))
        
        # 3. ì™„ë£Œ ì´ë²¤íŠ¸ ë°œí–‰
        await event_publisher.notify_stage(
            task_id=job_id,
            stage="vision",
            status="completed",
            progress=25,
            message=f"âœ… ë¶„ë¥˜ ì™„ë£Œ: {result['classification']['major_category']}",
        )
        
        # 4. state ì—…ë°ì´íŠ¸
        return {
            **state,
            "classification_result": result,
            "has_image": True,
        }
    
    return vision_node
```

### 4.4 Factory ìˆ˜ì •

```python
# infrastructure/orchestration/langgraph/factory.py
def create_chat_graph(
    llm: LLMClientPort,
    retriever: RetrieverPort,
    event_publisher: ProgressNotifierPort,
    vision_model: VisionModelPort | None = None,  # ì¶”ê°€
    ...
) -> StateGraph:
    # Vision ë…¸ë“œ ìƒì„±
    if vision_model:
        vision_node = create_vision_node(vision_model, event_publisher)
    else:
        async def vision_node(state): return state  # passthrough
    
    graph = StateGraph(dict)
    
    # ë…¸ë“œ ë“±ë¡
    graph.add_node("intent", intent_node)
    graph.add_node("vision", vision_node)
    graph.add_node("router", router_node)
    ...
    
    # ì¡°ê±´ë¶€ ì—£ì§€
    graph.add_conditional_edges("intent", route_after_intent, {
        "vision": "vision",
        "router": "router",
    })
    graph.add_edge("vision", "router")
```

---

## 5. ë°ì´í„° íë¦„

### 5.1 ì´ë¯¸ì§€ ìˆëŠ” ìš”ì²­ ì²˜ë¦¬

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    ì´ë¯¸ì§€ í¬í•¨ ìš”ì²­ ë°ì´í„° íë¦„                        â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     POST /chat                     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   Frontend   â”‚ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¶ â”‚   Chat API   â”‚
â”‚              â”‚     {                              â”‚              â”‚
â”‚  ğŸ“· + "ì´ê±°   â”‚       session_id: "abc",          â”‚              â”‚
â”‚   ì–´ë–»ê²Œ     â”‚       message: "ì´ê±° ì–´ë–»ê²Œ ë²„ë ¤ìš”?", â”‚              â”‚
â”‚   ë²„ë ¤ìš”?"   â”‚       image_url: "https://..."     â”‚              â”‚
â”‚              â”‚     }                              â”‚              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                                    â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜
                                                          â”‚
                                                          â”‚ RabbitMQ
                                                          â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                         Chat Worker                                 â”‚
â”‚                                                                     â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚
â”‚  â”‚                    LangGraph Pipeline                        â”‚    â”‚
â”‚  â”‚                                                             â”‚    â”‚
â”‚  â”‚  State: {                                                   â”‚    â”‚
â”‚  â”‚    job_id: "xyz",                                           â”‚    â”‚
â”‚  â”‚    message: "ì´ê±° ì–´ë–»ê²Œ ë²„ë ¤ìš”?",                            â”‚    â”‚
â”‚  â”‚    image_url: "https://...",     â—€â”€â”€ Frontendì—ì„œ ì „ë‹¬       â”‚    â”‚
â”‚  â”‚  }                                                          â”‚    â”‚
â”‚  â”‚           â”‚                                                 â”‚    â”‚
â”‚  â”‚           â–¼                                                 â”‚    â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                                            â”‚    â”‚
â”‚  â”‚  â”‚   Intent    â”‚  â†’ intent: "waste"                         â”‚    â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜                                            â”‚    â”‚
â”‚  â”‚         â”‚                                                   â”‚    â”‚
â”‚  â”‚         â”‚  image_url ìˆìŒ â†’ vision ë¶„ê¸°                      â”‚    â”‚
â”‚  â”‚         â–¼                                                   â”‚    â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                                            â”‚    â”‚
â”‚  â”‚  â”‚   Vision    â”‚  â†’ GPT-4o / Gemini Vision í˜¸ì¶œ             â”‚    â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜                                            â”‚    â”‚
â”‚  â”‚         â”‚                                                   â”‚    â”‚
â”‚  â”‚  State ì—…ë°ì´íŠ¸:                                              â”‚    â”‚
â”‚  â”‚  {                                                          â”‚    â”‚
â”‚  â”‚    ...                                                      â”‚    â”‚
â”‚  â”‚    classification_result: {        â—€â”€â”€ Vision ê²°ê³¼ ì €ì¥      â”‚    â”‚
â”‚  â”‚      classification: {                                      â”‚    â”‚
â”‚  â”‚        major_category: "ì¬í™œìš©íê¸°ë¬¼",                        â”‚    â”‚
â”‚  â”‚        middle_category: "í”Œë¼ìŠ¤í‹±ë¥˜",                         â”‚    â”‚
â”‚  â”‚        minor_category: "í˜íŠ¸ë³‘",                             â”‚    â”‚
â”‚  â”‚      },                                                     â”‚    â”‚
â”‚  â”‚      situation_tags: ["ì„¸ì²™í•„ìš”"],                            â”‚    â”‚
â”‚  â”‚      confidence: 0.95,                                      â”‚    â”‚
â”‚  â”‚    },                                                       â”‚    â”‚
â”‚  â”‚    has_image: true,                                         â”‚    â”‚
â”‚  â”‚  }                                                          â”‚    â”‚
â”‚  â”‚         â”‚                                                   â”‚    â”‚
â”‚  â”‚         â–¼                                                   â”‚    â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                                            â”‚    â”‚
â”‚  â”‚  â”‚  waste_rag  â”‚  â†’ classification_resultë¡œ ê·œì • ê²€ìƒ‰        â”‚    â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜                                            â”‚    â”‚
â”‚  â”‚         â”‚                                                   â”‚    â”‚
â”‚  â”‚         â–¼                                                   â”‚    â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                                            â”‚    â”‚
â”‚  â”‚  â”‚   Answer    â”‚  â†’ ë¶„ë¥˜ ê²°ê³¼ + ê·œì •ìœ¼ë¡œ ë‹µë³€ ìƒì„±            â”‚    â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                                            â”‚    â”‚
â”‚  â”‚                                                             â”‚    â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚
â”‚                                                                     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 5.2 SSE ì´ë²¤íŠ¸ ì‹œí€€ìŠ¤

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                     Vision í¬í•¨ SSE ì´ë²¤íŠ¸ ì‹œí€€ìŠ¤                     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

 Frontend                    Chat Worker                   SSE Gateway
    â”‚                            â”‚                              â”‚
    â”‚  POST /chat (with image)   â”‚                              â”‚
    â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¶â”‚                              â”‚
    â”‚                            â”‚                              â”‚
    â”‚  { job_id, stream_url }    â”‚                              â”‚
    â”‚â—€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚                              â”‚
    â”‚                            â”‚                              â”‚
    â”‚  GET /events (SSE)         â”‚                              â”‚
    â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¶â”‚
    â”‚                            â”‚                              â”‚
    â”‚                            â”‚  stage: "queued"  (0%)       â”‚
    â”‚â—€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚
    â”‚                            â”‚                              â”‚
    â”‚                            â”‚  stage: "intent"  (10%)      â”‚
    â”‚â—€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚
    â”‚                            â”‚                              â”‚
    â”‚                            â”‚  stage: "vision"  (15%)      â”‚
    â”‚â—€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚
    â”‚   ğŸ” ì´ë¯¸ì§€ ë¶„ì„ ì¤‘...       â”‚                              â”‚
    â”‚                            â”‚                              â”‚
    â”‚                            â”‚  (Vision API í˜¸ì¶œ ~2ì´ˆ)       â”‚
    â”‚                            â”‚                              â”‚
    â”‚                            â”‚  stage: "vision"  (25%)      â”‚
    â”‚â—€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚
    â”‚   âœ… ë¶„ë¥˜ ì™„ë£Œ: ì¬í™œìš©íê¸°ë¬¼  â”‚                              â”‚
    â”‚                            â”‚                              â”‚
    â”‚                            â”‚  stage: "waste_rag" (50%)    â”‚
    â”‚â—€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚
    â”‚                            â”‚                              â”‚
    â”‚                            â”‚  stage: "answer"   (75%)     â”‚
    â”‚â—€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚
    â”‚                            â”‚                              â”‚
    â”‚                            â”‚  token: "í˜" "íŠ¸" "ë³‘" ...    â”‚
    â”‚â—€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚
    â”‚                            â”‚                              â”‚
    â”‚                            â”‚  stage: "done"    (100%)     â”‚
    â”‚â—€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚
    â”‚                            â”‚                              â”‚
```

---

## 6. ë””ë ‰í† ë¦¬ êµ¬ì¡°

```
apps/chat_worker/
â”œâ”€â”€ application/
â”‚   â””â”€â”€ ports/
â”‚       â””â”€â”€ vision/
â”‚           â”œâ”€â”€ __init__.py
â”‚           â””â”€â”€ vision_model.py        # VisionModelPort (ABC)
â”‚
â”œâ”€â”€ infrastructure/
â”‚   â””â”€â”€ llm/
â”‚       â”œâ”€â”€ clients/                   # ê¸°ì¡´ LLM í´ë¼ì´ì–¸íŠ¸
â”‚       â””â”€â”€ vision/
â”‚           â”œâ”€â”€ __init__.py
â”‚           â”œâ”€â”€ openai_vision.py       # OpenAIVisionClient
â”‚           â””â”€â”€ gemini_vision.py       # GeminiVisionClient
â”‚
â””â”€â”€ infrastructure/
    â””â”€â”€ orchestration/
        â””â”€â”€ langgraph/
            â”œâ”€â”€ factory.py             # vision_model íŒŒë¼ë¯¸í„° ì¶”ê°€
            â””â”€â”€ nodes/
                â””â”€â”€ vision_node.py     # VisionNode êµ¬í˜„
```

---

## 7. í…ŒìŠ¤íŠ¸ ì „ëµ

### 7.1 ë‹¨ìœ„ í…ŒìŠ¤íŠ¸ (Mock Vision)

```python
class MockVisionModel(VisionModelPort):
    async def analyze_image(self, image_url, user_input=None):
        return {
            "classification": {
                "major_category": "ì¬í™œìš©íê¸°ë¬¼",
                "middle_category": "í”Œë¼ìŠ¤í‹±ë¥˜",
                "minor_category": "í˜íŠ¸ë³‘",
            },
            "situation_tags": ["ì„¸ì²™í•„ìš”"],
            "confidence": 0.95,
        }

async def test_vision_node_with_image():
    node = create_vision_node(MockVisionModel(), MockNotifier())
    state = {"job_id": "test", "image_url": "https://example.com/pet.jpg"}
    
    result = await node(state)
    
    assert result["classification_result"] is not None
    assert result["has_image"] is True
```

### 7.2 í†µí•© í…ŒìŠ¤íŠ¸ (Vision â†’ RAG í”Œë¡œìš°)

```python
async def test_vision_to_rag_flow():
    # Vision ë¶„ì„
    state = await vision_node({"image_url": "https://...", "message": "ì´ê±° ë­ì•¼?"})
    
    # RAG ê²€ìƒ‰ (Vision ê²°ê³¼ í™œìš©)
    state = await rag_node(state)
    
    # ë¶„ë¥˜ ê²°ê³¼ë¡œ ê·œì • ê²€ìƒ‰í–ˆëŠ”ì§€ í™•ì¸
    assert retriever.search_called
    assert state["disposal_rules"] is not None
```

---

## 8. ì„±ëŠ¥ ìµœì í™”

### 8.1 ì´ë¯¸ì§€ ì²˜ë¦¬ ìµœì í™”

| ìµœì í™” í•­ëª© | ì ìš© ë°©ë²• | íš¨ê³¼ |
|------------|----------|------|
| **detail: low** | OpenAI íŒŒë¼ë¯¸í„° | í† í° 89% ì ˆê° |
| **ì´ë¯¸ì§€ ìºì‹±** | ë™ì¼ ì´ë¯¸ì§€ ì¬ë¶„ë¥˜ ë°©ì§€ | API í˜¸ì¶œ ì ˆê° |
| **ë³‘ë ¬ ì²˜ë¦¬** | Intentì™€ Vision ë™ì‹œ ì‹¤í–‰ (í–¥í›„) | ì§€ì—° ì‹œê°„ ë‹¨ì¶• |

### 8.2 ë¹„ìš© ì˜ˆì¸¡

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                   Vision ë¹„ìš© ì˜ˆì¸¡ (ì›”ê°„)                    â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  ê°€ì •:                                                     â”‚
â”‚  - ì¼ 1,000ê±´ ì´ë¯¸ì§€ ìš”ì²­                                   â”‚
â”‚  - ì›” 30,000ê±´                                             â”‚
â”‚                                                            â”‚
â”‚  GPT-5.2-vision (detail: low):                             â”‚
â”‚  - Vision ì „ìš© ëª¨ë¸ (ì´ë¯¸ì§€ ì²˜ë¦¬ ìµœì í™”)                     â”‚
â”‚  - ì¶œë ¥: ~100 í† í°                                          â”‚
â”‚  - ì›”: ~$10-20                                             â”‚
â”‚                                                            â”‚
â”‚  Gemini 3 Flash Preview:                                   â”‚
â”‚  - ë©€í‹°ëª¨ë‹¬ í†µí•© ëª¨ë¸                                       â”‚
â”‚  - ë¬´ë£Œ í‹°ì–´: ì¶©ë¶„í•œ ì¼ì¼ í•œë„                               â”‚
â”‚  - ì›”: ~$2-5                                               â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

> **ì°¸ê³ **: ê°€ê²©ì€ 2026ë…„ 1ì›” ê¸°ì¤€ì´ë©° ë³€ë™ë  ìˆ˜ ìˆìŠµë‹ˆë‹¤.

---

## 9. í–¥í›„ í™•ì¥

### 9.1 ë‹¤ì¤‘ ì´ë¯¸ì§€ ì§€ì›

```python
# í˜„ì¬: ë‹¨ì¼ ì´ë¯¸ì§€
image_url: str | None

# í–¥í›„: ë‹¤ì¤‘ ì´ë¯¸ì§€
image_urls: list[str] | None
```

### 9.2 ì´ë¯¸ì§€ ë¶„ë¥˜ ìºì‹±

ë™ì¼ ì´ë¯¸ì§€(í•´ì‹œ ê¸°ì¤€)ì— ëŒ€í•œ ë¶„ë¥˜ ê²°ê³¼ ìºì‹±:

```python
class VisionCache:
    async def get_or_analyze(self, image_url: str) -> dict:
        cache_key = f"vision:{hashlib.sha256(image_url).hexdigest()[:16]}"
        cached = await redis.get(cache_key)
        if cached:
            return json.loads(cached)
        
        result = await vision_model.analyze_image(image_url)
        await redis.setex(cache_key, 3600, json.dumps(result))
        return result
```

---

## 10. ìš”ì•½

| í•­ëª© | ê²°ì • | ì´ìœ  |
|------|------|------|
| **Vision ìœ„ì¹˜** | Intent í›„ ì¡°ê±´ë¶€ | ë¶ˆí•„ìš”í•œ í˜¸ì¶œ ë°©ì§€ |
| **ê¸°ë³¸ ëª¨ë¸** | GPT-4o (low) | ì •í™•ë„ + ë¹„ìš© ê· í˜• |
| **detail ë ˆë²¨** | low | íê¸°ë¬¼ ëŒ€ë¶„ë¥˜ì— ì¶©ë¶„ |
| **ê²°ê³¼ ì €ì¥** | state.classification_result | RAG ë…¸ë“œ í™œìš© |
| **ì´ë²¤íŠ¸ ë°œí–‰** | vision stage (15%â†’25%) | ì‹¤ì‹œê°„ ì§„í–‰ í‘œì‹œ |

---

## ì»¤ë°‹ ì •ë³´

**Commit**: `da24a5dbfa0e4eb3c4d76f4e0f2c5e9e7a8b1c3d`

```
feat(chat-worker): add Vision processing support

- Add VisionModelPort (application/ports/vision)
- Add OpenAIVisionClient, GeminiVisionClient (infrastructure/llm/vision)
- Add VisionNode for image classification (orchestration/langgraph/nodes)
- Update factory.py: intent â†’ [vision?] â†’ router flow
- Update dependencies.py: create_vision_client factory

Flow:
1. Intent node processes message
2. If image_url exists, Vision node analyzes image
3. classification_result stored in state
4. RAG/Answer nodes use classification result
```

**Changed Files (10)**

ì£¼ìš” íŒŒì¼:
- `application/ports/vision/vision_model.py` â€” VisionModelPort (ABC)
- `infrastructure/llm/vision/openai_vision.py` â€” OpenAI GPT-4V í´ë¼ì´ì–¸íŠ¸
- `infrastructure/llm/vision/gemini_vision.py` â€” Gemini Vision í´ë¼ì´ì–¸íŠ¸
- `infrastructure/orchestration/langgraph/nodes/vision_node.py` â€” Vision ë…¸ë“œ
- `infrastructure/orchestration/langgraph/factory.py` â€” ê·¸ë˜í”„ í”Œë¡œìš° ìˆ˜ì •
- `setup/dependencies.py` â€” create_vision_client íŒ©í† ë¦¬ ì¶”ê°€

