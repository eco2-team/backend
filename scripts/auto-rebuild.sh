#!/bin/bash
# μ™„μ „ μλ™ μ¬κµ¬μ¶• (ν™•μΈ μ—†μ΄ μ§„ν–‰)
# 1. cleanup.sh μ‹¤ν–‰ (μΈν”„λΌ λ° κµ¬μ„±μ”μ† μ‚­μ )
# 2. build-cluster.sh μ‹¤ν–‰ (μΈν”„λΌ κµ¬μ¶•)

set -e

SCRIPT_DIR="$(cd "$(dirname "${BASH_SOURCE[0]}")" && pwd)"

echo "β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”"
echo "π¤– μ™„μ „ μλ™ μ¬κµ¬μ¶• μ‹μ‘"
echo "β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”"
echo ""
echo "β οΈ  ν™•μΈ ν”„λ΅¬ν”„νΈ μ—†μ΄ μλ™ μ‹¤ν–‰λ©λ‹λ‹¤!"
echo ""
echo "π“‹ μ‹¤ν–‰ μμ„:"
echo "   1οΈβƒ£  cleanup.sh (μΈν”„λΌ λ° κµ¬μ„±μ”μ† μ‚­μ )"
echo "   2οΈβƒ£  build-cluster.sh (μΈν”„λΌ κµ¬μ¶•)"
echo ""

# μλ™ λ¨λ“ μ„¤μ •
export AUTO_MODE=true

# 1. μΈν”„λΌ λ° κµ¬μ„±μ”μ† μ‚­μ 
echo "β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”"
echo "1οΈβƒ£ μΈν”„λΌ λ° κµ¬μ„±μ”μ† μ‚­μ  (cleanup.sh)"
echo "β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”"
echo ""

# cleanup.shκ°€ μ—†μΌλ©΄ destroy-with-cleanup.sh μ‚¬μ© (ν•μ„ νΈν™)
CLEANUP_SCRIPT="$SCRIPT_DIR/cleanup.sh"
if [ ! -f "$CLEANUP_SCRIPT" ]; then
    CLEANUP_SCRIPT="$SCRIPT_DIR/destroy-with-cleanup.sh"
fi

set +e  # cleanup μ‹¤ν¨ν•΄λ„ κ³„μ† μ§„ν–‰
"$CLEANUP_SCRIPT"
CLEANUP_EXIT_CODE=$?
set -e  # λ‹¤μ‹ μ—λ¬ μ²΄ν¬ ν™μ„±ν™”

if [ $CLEANUP_EXIT_CODE -ne 0 ]; then
    echo ""
    echo "β οΈ  cleanup.sh μ‹¤ν¨ (exit code: $CLEANUP_EXIT_CODE)"
    echo "   μΌλ¶€ λ¦¬μ†μ¤κ°€ λ‚¨μ•„μμ„ μ μμµλ‹λ‹¤."
    echo "   κ³„μ† μ§„ν–‰ν•©λ‹λ‹¤..."
    echo ""
fi

# 2. μΈν”„λΌ κµ¬μ¶•
echo ""
echo "β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”"
echo "2οΈβƒ£ μΈν”„λΌ κµ¬μ¶• (build-cluster.sh)"
echo "β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”"
echo ""

"$SCRIPT_DIR/build-cluster.sh"

echo ""
echo "β… μλ™ μ¬κµ¬μ¶• μ™„λ£!"


