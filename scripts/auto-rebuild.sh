#!/bin/bash
# μ™„μ „ μλ™ μ¬κµ¬μ¶• (ν™•μΈ μ—†μ΄ μ§„ν–‰)
# 1. destroy-with-cleanup.sh μ‹¤ν–‰ (λ¦¬μ†μ¤ μ •λ¦¬)
# 2. rebuild-cluster.sh μ‹¤ν–‰ (μ¬κµ¬μ¶•)

set -e

SCRIPT_DIR="$(cd "$(dirname "${BASH_SOURCE[0]}")" && pwd)"

echo "β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”"
echo "π¤– μ™„μ „ μλ™ μ¬κµ¬μ¶• μ‹μ‘"
echo "β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”"
echo ""
echo "β οΈ  ν™•μΈ ν”„λ΅¬ν”„νΈ μ—†μ΄ μλ™ μ‹¤ν–‰λ©λ‹λ‹¤!"
echo ""
echo "π“‹ μ‹¤ν–‰ μμ„:"
echo "   1οΈβƒ£  destroy-with-cleanup.sh (λ¦¬μ†μ¤ μ •λ¦¬)"
echo "   2οΈβƒ£  rebuild-cluster.sh (μΈν”„λΌ μ¬κµ¬μ¶•)"
echo ""

# μλ™ λ¨λ“ μ„¤μ •
export AUTO_MODE=true

# 1. λ¦¬μ†μ¤ μ •λ¦¬
echo "β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”"
echo "1οΈβƒ£ λ¦¬μ†μ¤ μ •λ¦¬ (destroy-with-cleanup.sh)"
echo "β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”"
echo ""

"$SCRIPT_DIR/destroy-with-cleanup.sh"

if [ $? -ne 0 ]; then
    echo ""
    echo "β οΈ  destroy-with-cleanup.sh μ‹¤ν¨"
    echo "   Kubernetes λ¦¬μ†μ¤ μ •λ¦¬ μ—†μ΄ μ§„ν–‰ν•©λ‹λ‹¤..."
    echo ""
fi

# 2. μΈν”„λΌ μ¬κµ¬μ¶•
echo ""
echo "β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”"
echo "2οΈβƒ£ μΈν”„λΌ μ¬κµ¬μ¶• (rebuild-cluster.sh)"
echo "β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”β”"
echo ""

"$SCRIPT_DIR/rebuild-cluster.sh"

echo ""
echo "β… μλ™ μ¬κµ¬μ¶• μ™„λ£!"


